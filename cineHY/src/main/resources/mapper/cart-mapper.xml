<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hy.myapp.cart.model.repository.CartRepository">

	<!-- 계정별 장바구니 리스트 조회 -->
	<select id="findById" resultType="cart">
		SELECT
			        C.CART_NO cartNo,
			        C.CART_AMOUNT cartAmount,
			        P.PRODUCT_ID productId,
			        P.PRODUCT_NAME productName,
			        P.PRODUCT_CATEGORY productCategory,
			        P.PRODUCT_COMMENT productComment,
			        P.PRODUCT_PRICE productPrice,
			        P.CHANGE_IMAGE changeImage,
			        M.USER_ID userId
  		  FROM
			        TB_CART C,
			        TB_PRODUCT P,
			        TB_MEMBER M
 		WHERE
 					M.USER_ID = #{userId}
 			AND
       				C.PRODUCT_ID = P.PRODUCT_ID
   			AND
        			C.USER_ID = M.USER_ID
	</select>
	
	<!-- 장바구니를 조회하여 추가하려는 상품과 일치하는 상품이 있는지 체크 -->
	<select id="findByCart" resultType="_int">
			SELECT
		        		COUNT(*)
		   	  FROM 
		        		TB_CART C
		LEFT JOIN 
						TB_MEMBER M
		   		  ON 
		   				C.USER_ID = M.USER_ID
		LEFT JOIN 
						TB_PRODUCT P
		    	  ON 
		    			C.PRODUCT_ID = P.PRODUCT_ID
		    WHERE 
		    			C.USER_ID = #{userId}
		    	AND 
		    			P.PRODUCT_ID = #{productId}
	</select>
	
	<!-- 장바구니 추가 -->
	<insert id="apply" parameterType="cart">
		INSERT
		   INTO
		   			TB_CART
	   				(
	   				CART_NO,
	   				USER_ID,
	   				PRODUCT_ID,
	   				CART_AMOUNT
	   				)
	   VALUES
	   				(
	   				SEQ_CNO.NEXTVAL,
	   				#{userId},
	   				#{productId},
	   				#{cartAmount}
	   				)
	</insert>
	
	<delete id="delete" parameterType="cart">
		DELETE
  		   FROM
        			TB_CART
 		 WHERE
        			USER_ID = #{userId}
   			 AND
        			PRODUCT_ID = #{productId}
	</delete>
</mapper>