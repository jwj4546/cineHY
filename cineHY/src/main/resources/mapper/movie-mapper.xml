<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="movieMapper">

<select id="getMovieIdList" resultType="java.lang.Integer">

		 SELECT
	    	    MOVIE_CODE
	       FROM
	       		TB_MOVIE
	      WHERE
      			STATUS = 'Y'
	       		

</select>


<insert id="insertMovie" parameterType="movie">

	MERGE INTO 
				TB_MOVIE target
	  	 USING (
	    		SELECT  #{movieCode} MOVIE_CODE, 
	           			#{movieTitle} MOVIE_TITLE, 
           				#{genre} GENRE, 
           				#{summary} SUMMARY, 
           				#{runningTime} RUNNING_TIME, 
           				#{rating} RATING, 
          				#{openedDate} OPENED_DATE
      	 	 	  FROM dual
			   ) source
			ON (target.MOVIE_CODE = source.MOVIE_CODE)
		  WHEN 
	   MATCHED
	   	  THEN
		UPDATE 
		   SET
		STATUS = 'Y'
          WHEN 
   NOT MATCHED
   		  THEN
		INSERT (
				MOVIE_CODE, 
				MOVIE_TITLE, 
				GENRE, 
				SUMMARY, 
				RUNNING_TIME, 
				RATING, 
				OPENED_DATE, 
				STATUS
				)
	    VALUES (
	    		source.MOVIE_CODE, 
	    		source.MOVIE_TITLE, 
	    		source.GENRE, 
	    		source.SUMMARY, 
	    		source.RUNNING_TIME,
	    		source.RATING, 
	    		source.OPENED_DATE, 
	    		'Y')

</insert>

<select id="getMovieList" resultType="movie">

	 SELECT
    	    MOVIE_CODE movieCode,
    	    MOVIE_TITLE movieTitle,
    	    GENRE,
    	    SUMMARY,
    	    RUNNING_TIME runningTime,
    	    RATING,
    	    OPENED_DATE openedDate
       FROM
       		TB_MOVIE
      WHERE
      		STATUS = 'Y'

</select>

<update id="deleteMovie" parameterType="_int" >
	UPDATE
		   TB_MOVIE
	   SET
	   	   STATUS = 'N'
	 WHERE
	 	   MOVIE_CODE = #{movieCode} 

</update>


</mapper>